---
title: Frequently Asked Questions
slug: Mozilla/Tech/XPCOM/Using_nsCOMPtr/Frequently_Asked_Questions
tags:
  - XPCOM
translation_of: Mozilla/Tech/XPCOM/Using_nsCOMPtr/Frequently_Asked_Questions
---
<p>
</p><p>このセクションは、もしあなたが壊れたビルドを直したり、即答できる明らかな疑問を持っていたり、あるいは <a href="ja/Using_nsCOMPtr/Reference_Manual">リファレンスマニュアル</a> を読む時間がない場合に役に立つでしょう。この FAQ は、通常は適切な答えへ直接的に参照するだけです。もしあなたが単に <code>nsCOMPtr</code> について学ぶことを期待しているのであれば、<a href="ja/Using_nsCOMPtr/Getting_Started_Guide">スタートガイド</a> にもっと良い紹介があります。
</p><p>FAQ は、探しているものを早く見つけやすくするために複数のセクションに分かれています。 ほとんどの場合、答えは上記のリファレンスマニュアルを参照しているだけです。 同じことを 2 度説明する必要はありません <code><span class="nowiki">:-)</span></code>
</p>
<h3 id=".E3.83.93.E3.83.AB.E3.83.89.E6.99.82.E3.81.AE.E3.82.A8.E3.83.A9.E3.83.BC" name=".E3.83.93.E3.83.AB.E3.83.89.E6.99.82.E3.81.AE.E3.82.A8.E3.83.A9.E3.83.BC"> ビルド時のエラー </h3>
<p>ビルドが壊れました。エラーがあなた自身のコードでもなく、あなたのプラットフォームのコードでもなく、<code>nsCOMPtr</code>の 中で起こっており、そしてあなたはそれを疑っています。あなたは正しい場所を見ています。
</p>
<h4 id="nsCOMPtr_.E3.81.A8.E7.94.9F.E3.81.AE_.5BXP.5DCOM_.E3.82.A4.E3.83.B3.E3.82.BF.E3.83.95.E3.82.A7.E3.83.BC.E3.82.B9.E3.83.9D.E3.82.A4.E3.83.B3.E3.82.BF.E3.82.92.E6.AF.94.E8.BC.83.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.99" name="nsCOMPtr_.E3.81.A8.E7.94.9F.E3.81.AE_.5BXP.5DCOM_.E3.82.A4.E3.83.B3.E3.82.BF.E3.83.95.E3.82.A7.E3.83.BC.E3.82.B9.E3.83.9D.E3.82.A4.E3.83.B3.E3.82.BF.E3.82.92.E6.AF.94.E8.BC.83.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.99"> <code>nsCOMPtr</code> と生の [XP]COM インタフェースポインタを比較しています </h4>
<h4 id="nsCOMPtr_.E3.82.92.E5.BE.8C.E3.81.AB.E5.AE.A3.E8.A8.80.E3.81.97.E3.81.A6.E3.81.84.E3.82.8B.E3.82.AF.E3.83.A9.E3.82.B9.E3.81.AB.E5.AF.BE.E3.81.97.E3.81.A6.E5.AE.A3.E8.A8.80.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.99" name="nsCOMPtr_.E3.82.92.E5.BE.8C.E3.81.AB.E5.AE.A3.E8.A8.80.E3.81.97.E3.81.A6.E3.81.84.E3.82.8B.E3.82.AF.E3.83.A9.E3.82.B9.E3.81.AB.E5.AF.BE.E3.81.97.E3.81.A6.E5.AE.A3.E8.A8.80.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.99"> <code>nsCOMPtr</code> を後に宣言しているクラスに対して宣言しています </h4>
<h4 id="XPCOM_.E3.81.A8.E3.83.AA.E3.83.B3.E3.82.AF.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.9B.E3.82.93" name="XPCOM_.E3.81.A8.E3.83.AA.E3.83.B3.E3.82.AF.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.9B.E3.82.93"> XPCOM とリンクしていません </h4>
<h4 id="nsCOMPtr.h_.E3.82.92.E3.82.A4.E3.83.B3.E3.82.AF.E3.83.AB.E3.83.BC.E3.83.89.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.9B.E3.82.93" name="nsCOMPtr.h_.E3.82.92.E3.82.A4.E3.83.B3.E3.82.AF.E3.83.AB.E3.83.BC.E3.83.89.E3.81.97.E3.81.A6.E3.81.84.E3.81.BE.E3.81.9B.E3.82.93"> nsCOMPtr.h をインクルードしていません </h4>
<h4 id="NSCAP_FEATURE_DEBUG_PTR_TYPES_.E3.81.AE.E8.A8.AD.E5.AE.9A.E3.81.8C.E9.81.95.E3.81.84.E3.81.BE.E3.81.99" name="NSCAP_FEATURE_DEBUG_PTR_TYPES_.E3.81.AE.E8.A8.AD.E5.AE.9A.E3.81.8C.E9.81.95.E3.81.84.E3.81.BE.E3.81.99"> <code>NSCAP_FEATURE_DEBUG_PTR_TYPES</code> の設定が違います </h4>
<h3 id=".E5.AE.9F.E8.A1.8C.E6.99.82.E3.81.AE.E3.82.A8.E3.83.A9.E3.83.BC" name=".E5.AE.9F.E8.A1.8C.E6.99.82.E3.81.AE.E3.82.A8.E3.83.A9.E3.83.BC"> 実行時のエラー </h3>
<h4 id="NS_ASSERTION_.22QueryInterface_needed.22" name="NS_ASSERTION_.22QueryInterface_needed.22"> <code>NS_ASSERTION</code> "QueryInterface needed" </h4>
<h4 id="NS_PRECONDITION_.22You_can.27t_dereference_a_NULL_nsCOMPtr_with_operator-.3E.28.29.22" name="NS_PRECONDITION_.22You_can.27t_dereference_a_NULL_nsCOMPtr_with_operator-.3E.28.29.22"> <code>NS_PRECONDITION</code> "You can't dereference a NULL nsCOMPtr with operator-&gt;()" </h4>
<h4 id="NS_PRECONDITION_.22You_can.27t_dereference_a_NULL_nsCOMPtr_with_operator.2A.28.29.22" name="NS_PRECONDITION_.22You_can.27t_dereference_a_NULL_nsCOMPtr_with_operator.2A.28.29.22"> <code>NS_PRECONDITION</code> "You can't dereference a NULL nsCOMPtr with operator*()" </h4>
<h3 id=".E3.81.A9.E3.81.86.E3.82.84.E3.81.A3.E3.81.A6..." name=".E3.81.A9.E3.81.86.E3.82.84.E3.81.A3.E3.81.A6..."> どうやって... </h3>
<h4 id="nsCOMPtr_.E3.82.92.E5.88.9D.E6.9C.9F.E5.8C.96.E3.81.99.E3.82.8B.E3.81.AE.E3.81.A7.E3.81.99.E3.81.8B.EF.BC.9F" name="nsCOMPtr_.E3.82.92.E5.88.9D.E6.9C.9F.E5.8C.96.E3.81.99.E3.82.8B.E3.81.AE.E3.81.A7.E3.81.99.E3.81.8B.EF.BC.9F"> <code>nsCOMPtr</code> を初期化するのですか？ </h4>
<h4 id="nsCOMPtr_.E3.81.8C.E3.82.B9.E3.82.B3.E3.83.BC.E3.83.97.E3.82.92.E6.8A.9C.E3.81.91.E3.82.8B.E5.89.8D.E3.81.AB.E3.81.9D.E3.82.8C.E3.82.92_Release_.E3.81.99.E3.82.8B.E3.81.AE.E3.81.A7.E3.81.99.E3.81.8B.EF.BC.9F" name="nsCOMPtr_.E3.81.8C.E3.82.B9.E3.82.B3.E3.83.BC.E3.83.97.E3.82.92.E6.8A.9C.E3.81.91.E3.82.8B.E5.89.8D.E3.81.AB.E3.81.9D.E3.82.8C.E3.82.92_Release_.E3.81.99.E3.82.8B.E3.81.AE.E3.81.A7.E3.81.99.E3.81.8B.EF.BC.9F"> <code>nsCOMPtr</code> がスコープを抜ける前にそれを <code>Release</code> するのですか？ </h4>
<p>それに <code>0</code> を代入してください。<code>nsCOMPtr</code> が新しい値を取る時は、古い値があれば、いつもそれを <code>Release</code> します。値 <code>0</code> を割り当てるということは、<code>NULL</code> の生のポインタを割り当てるのと同じようなことです。古い対象は、<code>Release</code> されます。(より詳しくは、<a href="ja/Using_nsCOMPtr/Reference_Manual#.E5.88.9D.E6.9C.9F.E5.8C.96.E3.81.A8.E4.BB.A3.E5.85.A5">初期化と代入</a> を見てください。)
</p><p>ただし、これには小さなパフォーマンス上のペナルティがあることに注意してください。<code>nsCOMPtr</code> は、デストラクタの処理の中で、その時持つ値を <code>Release</code> しようとします。最良の解決法は、<code>nsCOMPtr</code> の生存期間をその参照を保持したい期間だけに調整することです。例えば、この例ではブロックを使っています。
</p>
<table>
<tbody><tr>
<td>
<pre class="eval"><span class="comment">// 最も効率的な枠組は、|nsCOMPtr| がちょうどその参照を</span>
<span class="comment">// 保持する必要のある期間だけのスコープを設定することです。</span>

nsresult
SomeLongFunction( nsIBar* aBar )
  {
    nsresult rv;
    <span class="comment">// ...</span>

    {
      <span class="comment">// |nsIFoo| インタフェースは、短期間だけ必要です。</span>
      <span class="comment">// そのため、その生存期間をブロック文の中で</span>
      <span class="comment">// 宣言して、制御します。</span>

      nsCOMPtr&lt;nsIFoo&gt; foo( do_QueryInterface(aBar, &amp;rv) );
      if ( foo )
        foo-&gt;DoSomeFooThing();

      <span class="comment">// |foo| がスコープをはずれました。そのため、ここで |Release| が実行されます。</span>
    }

    <span class="comment">// ...ここには |nsIFoo| を必要としない多くの事柄があります。</span>

    return rv;
  }
</pre>
</td></tr></tbody></table>
<p>編集者注: この議論を <a href="ja/Using_nsCOMPtr/Reference_Manual#.E5.8A.B9.E7.8E.87.E6.80.A7.E3.81.A8.E6.AD.A3.E7.A2.BA.E6.80.A7">効率性</a>のセクションへ移動し、ここからリンクを張ります。
</p>
<h4 id="nsCOMPtr_.E3.81.AE.E3.83.AA.E3.83.BC.E3.82.AF.E3.82.92.E4.BD.9C.E3.82.8B.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B_.28.E3.83.87.E3.83.90.E3.83.83.E3.82.B0.E3.83.86.E3.82.B9.E3.83.88.E3.81.AE.E3.81.9F.E3.82.81.29_.EF.BC.9F" name="nsCOMPtr_.E3.81.AE.E3.83.AA.E3.83.BC.E3.82.AF.E3.82.92.E4.BD.9C.E3.82.8B.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B_.28.E3.83.87.E3.83.90.E3.83.83.E3.82.B0.E3.83.86.E3.82.B9.E3.83.88.E3.81.AE.E3.81.9F.E3.82.81.29_.EF.BC.9F"> <code>nsCOMPtr</code> のリークを作るのでしょうか (デバッグテストのため) ？ </h4>
<h4 id=".E7.94.9F.E3.81.AE_.5BXP.5DCOM_.E3.82.A4.E3.83.B3.E3.82.BF.E3.83.95.E3.82.A7.E3.83.BC.E3.82.B9.E3.83.9D.E3.82.A4.E3.83.B3.E3.82.BF.E3.82.92.E3.80.8C.E5.85.A5.E5.87.BA.E5.8A.9B.E3.80.8D.E3.83.91.E3.83.A9.E3.83.A1.E3.82.BF.E3.81.A8.E3.81.97.E3.81.A6.E4.BD.BF.E3.81.86_getter_.E3.82.92.E5.91.BC.E3.81.B9.E3.81.B0.E3.82.88.E3.81.84.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B.EF.BC.9F" name=".E7.94.9F.E3.81.AE_.5BXP.5DCOM_.E3.82.A4.E3.83.B3.E3.82.BF.E3.83.95.E3.82.A7.E3.83.BC.E3.82.B9.E3.83.9D.E3.82.A4.E3.83.B3.E3.82.BF.E3.82.92.E3.80.8C.E5.85.A5.E5.87.BA.E5.8A.9B.E3.80.8D.E3.83.91.E3.83.A9.E3.83.A1.E3.82.BF.E3.81.A8.E3.81.97.E3.81.A6.E4.BD.BF.E3.81.86_getter_.E3.82.92.E5.91.BC.E3.81.B9.E3.81.B0.E3.82.88.E3.81.84.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B.EF.BC.9F"> 生の [XP]COM インタフェースポインタを「入出力」パラメタとして使う getter を呼べばよいのでしょうか？ </h4>
<h4 id="nsIFoo.2A_.E3.83.91.E3.83.A9.E3.83.A1.E3.82.BF.E3.81.A7.E8.A8.AD.E5.AE.9A.E3.81.99.E3.82.8B_getter_.E3.82.92.E5.91.BC.E3.81.B9.E3.81.B0.E3.82.88.E3.81.84.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B.EF.BC.9F" name="nsIFoo.2A&amp;_.E3.83.91.E3.83.A9.E3.83.A1.E3.82.BF.E3.81.A7.E8.A8.AD.E5.AE.9A.E3.81.99.E3.82.8B_getter_.E3.82.92.E5.91.BC.E3.81.B9.E3.81.B0.E3.82.88.E3.81.84.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B.EF.BC.9F"> <code>nsIFoo*&amp;</code> パラメタで設定する getter を呼べばよいのでしょうか？ </h4>
<h4 id=".E3.81.9D.E3.81.AE.E7.B5.90.E6.9E.9C.E3.82.92_AddRef_.E3.81.97.E3.81.AA.E3.81.84_getter_.E3.82.92.E5.91.BC.E3.81.B9.E3.81.B0.E3.82.88.E3.81.84.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B.3F" name=".E3.81.9D.E3.81.AE.E7.B5.90.E6.9E.9C.E3.82.92_AddRef_.E3.81.97.E3.81.AA.E3.81.84_getter_.E3.82.92.E5.91.BC.E3.81.B9.E3.81.B0.E3.82.88.E3.81.84.E3.81.AE.E3.81.A7.E3.81.97.E3.82.87.E3.81.86.E3.81.8B.3F"> その結果を <code>AddRef</code> しない getter を呼べばよいのでしょうか? </h4>
<p>インタフェースポインタを返すどの {{ mediawiki.external('XP') }}COM 関数 (getter) も、そのポインタに対して <code>AddRef</code> をすでに呼び出していなければいけません。 もしそれが行われないのであれば、おそらくそれをバグとして報告すべきでしょう。 この問題を解決するのに使うどのコードパターンに対しても、このようにコメントすべきです。 例えば、<code><span class="comment">// 警告: この getter は 結果を AddRef() していません。</span></code> もし getter が新しいポインタを関数の復帰値として返すのであれば、心配いりません。
</p>
<h3 id=".E4.B8.80.E8.88.AC" name=".E4.B8.80.E8.88.AC"> 一般 </h3>
<h4 id="nsCOMPtr_.E3.81.AF.E3.80.81.E3.82.B3.E3.83.BC.E3.83.89.E3.82.92.E8.86.A8.E5.BC.B5.E3.81.95.E3.81.9B.E3.81.BE.E3.81.99.E3.81.8B.EF.BC.9F" name="nsCOMPtr_.E3.81.AF.E3.80.81.E3.82.B3.E3.83.BC.E3.83.89.E3.82.92.E8.86.A8.E5.BC.B5.E3.81.95.E3.81.9B.E3.81.BE.E3.81.99.E3.81.8B.EF.BC.9F"> <code>nsCOMPtr</code> は、コードを膨張させますか？ </h4>
<h4 id="nsCOMPtr_.E3.81.AF.E9.80.9F.E3.81.84.E3.81.A7.E3.81.99.E3.81.8B.EF.BC.9F_.E3.82.BF.E3.82.A4.E3.83.88.E3.81.AA.E3.83.AB.E3.83.BC.E3.83.97.E3.81.AE.E4.B8.AD.E3.81.A7.E3.82.82.E4.BD.BF.E3.81.88.E3.81.BE.E3.81.99.E3.81.8B.EF.BC.9F" name="nsCOMPtr_.E3.81.AF.E9.80.9F.E3.81.84.E3.81.A7.E3.81.99.E3.81.8B.EF.BC.9F_.E3.82.BF.E3.82.A4.E3.83.88.E3.81.AA.E3.83.AB.E3.83.BC.E3.83.97.E3.81.AE.E4.B8.AD.E3.81.A7.E3.82.82.E4.BD.BF.E3.81.88.E3.81.BE.E3.81.99.E3.81.8B.EF.BC.9F"> <code>nsCOMPtr</code> は速いですか？ タイトなループの中でも使えますか？ </h4>
<h3 id=".E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE.E4.B8.80.E8.A6.A7" name=".E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE.E4.B8.80.E8.A6.A7"> 参考文献一覧 </h3>
<h4 id="Web_.E3.83.AA.E3.82.BD.E3.83.BC.E3.82.B9" name="Web_.E3.83.AA.E3.82.BD.E3.83.BC.E3.82.B9"> Web リソース </h4>
<ul><li> {{ Source("xpcom/glue/nsCOMPtr.h", "nsCOMPtr.h") }} と {{ Source("xpcom/glue/nsCOMPtr.cpp", "nsCOMPtr.cpp") }} は、<code>nsCOMPtr</code>のソースです。<a class="external" href="http://lxr.mozilla.org/">LXR</a> を使って、<code>nsCOMPtr</code>のソースをオンラインで調べることができます。このコードを探検するのは、心臓が弱い人にとっても、冒険ではありません。
</li><li> <a href="ja/XPCOM_ownership_guidelines">COM の所有のガイドライン</a>
</li><li> <a class="external" href="http://www.develop.com/dbox/cxx/InterfacePtr.htm">Interface Pointers Considered Harmful</a> - Don Box 著 - "The C++ Report" 1995 年 9 月号初出記事
</li><li> <a class="external" href="http://www.develop.com/dbox/cxx/SmartPtr.htm">COM Smart Pointers Even More Harmful</a> - Don Box 著 - "The C++ Report" 1996 年 2 月号初出記事のフォローアップ
</li></ul>
<h4 id=".E6.9B.B8.E7.B1.8D" name=".E6.9B.B8.E7.B1.8D"> 書籍 </h4>
<ul><li> <a class="external" href="http://www.amazon.com/exec/obidos/ASIN/0201634465">Essential COM</a> - Don Box 著
</li><li> <a class="external" href="http://www.amazon.com/exec/obidos/ASIN/0201379686">Effective COM</a> - Don Box 他著
</li><li> <a class="external" href="http://www.amazon.com/exec/obidos/ASIN/0201889544">The C++ Programming Language (3rd Edition)</a> - Bjarne Stroustrup 著
</li><li> <a class="external" href="http://www.amazon.com/exec/obidos/ASIN/0201924889">Effective C++ (2nd Edition): 50 Specific Ways to Improve Your Programs and Designs</a> - Scott Meyers 著
</li><li> <a class="external" href="http://www.amazon.com/exec/obidos/ASIN/020163371X">More Effective C++ : 35 New Ways to Improve Your Programs and Designs</a> - Scott Meyers 著
</li><li> <a class="external" href="http://www.amazon.com/exec/obidos/ASIN/0201310155">Effective C++ CD: 85 Specific Ways to Improve Your Programs and Designs</a> - Scott Meyers 著
</li></ul>
<h4 id=".E4.BA.BA.E3.80.85" name=".E4.BA.BA.E3.80.85"> 人々 </h4>
<ul><li> <a class="external" href="http://www.develop.com/dbox/">Don Box</a> 長い間 COM プログラミングについて書いてきた頭のいい人です。
</li></ul>
<div class="noinclude">
</div>
{{ languages( { "en": "en/Using_nsCOMPtr/Frequently_Asked_Questions" } ) }}
