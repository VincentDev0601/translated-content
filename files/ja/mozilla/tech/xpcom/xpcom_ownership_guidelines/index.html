---
title: XPCOM ownership guidelines
slug: Mozilla/Tech/XPCOM/XPCOM_ownership_guidelines
tags:
  - XPCOM
translation_of: Mozilla/Tech/XPCOM/XPCOM_ownership_guidelines
---
<h3 id="もしあなたがそれを作ったのであれば、それを所有している"> もしあなたがそれを作ったのであれば、それを所有している </h3>
<p>...自然なことです。もしあなたが一時的なオブジェクトを作ったのであれば、明らかにそれを破壊するのはあなたの責任です。それは確かに所有の徴候です。もしあなたがより長い生存期間を持つオブジェクトを作ったのであれば、あなたは所有権を失うまでそれを所有することになるでしょう。
</p><p>すべての「factory」と「getter」関数は所有するポインターを作り出す。
</p><p>そのような関数は、より長い生存期間を持つオブジェクトを作る絶好の例です。そして、(すでに <code>AddRef</code> を実行したポインターをつくり出すことで) 所有権を (この場合は呼び出し元に) 与えます。これはファクトリ関数にとってすばらしいことです。しかし単なる「getter」にとっては問題となりうるかもしれません。しばらくの間しかアクセスが必要ないのであれば、運が悪いということになります。後者の場合、ポインタをキャッシュした場合、あなたはデフォルトの所有者になります。これは、適切でないかも知れません。そして、問題のオブジェクトがあなたのクエリに対して作られのかどうかを知らずに修正するのは大変かもしれません。
</p>
<h3 id="それを必要としているかどうかは、それを所有していることの正当な理由にはならない"> それを必要としているかどうかは、それを所有していることの正当な理由にはならない </h3>
<p><b>あなた</b>が<b>オブジェクト</b>を必要としているからと言って、そのオブジェクトを所有しているわけではありません。実際、しばしば<b>オブジェクト</b>が<b>あなた</b>を必要としているために、そのオブジェクトを所有していることがあります。
</p>
<h3 id="もしあなたがオブジェクトを所有しているのならば、それはあなたを所有すべきではない。"> もし<b>あなた</b>が<b>オブジェクト</b>を所有しているのならば、それはあなたを所有すべきではない。</h3>
<p>推移的な意味でもそのことが言えます。<span style="color: darkgreen; background: #ef9;">【訳注: A が B を所有し、B が C を所有する場合、C が A を所有してはいけない】</span> 違う表現をすると: どんなシステムにおいても所有権のグラフは非循環的でなければなりません。所有権の循環が存在する場合、デストラクターによって自動的に処理されない場合があります。循環を断ち切るには、参加者が個別に解放する前に、特別なコードが提供されて呼ばれなければなりません。
</p>
<h3 id="オブジェクトの生存期間があなたより長いことが保証されているのであれば、そのオブジェクトを所有する必要はない"> オブジェクトの生存期間があなたより長いことが保証されているのであれば、そのオブジェクトを所有する必要はない </h3>
<p>例えば、それがあなたを所有している時です。
</p>
<h3 id="親は自分の子を所有する_そして逆ではない"> 親は自分の子を所有する (そして逆ではない) </h3>
<p>親は自分の子を所有する<b>必要</b>はないかもしれませんが。例えば、ツリーはその中にあるすべてのノードを所有するかもしれません。ツリーのすべてのノードが、お互いを非所有的なポインターでポイントしているかもしれません。しかしながら、最も単純な枠組では、親は自分の子を所有的なポインターでポイントし、子は自分の親を非所有的なポインターで指し返します。
</p>
<h3 id="コンテナは、自分が含むものを所有する_そして逆ではない"> コンテナは、自分が含むものを所有する (そして逆ではない) </h3>
<h3 id="所有するポインターを実装するために、nsCOMPtr_を使いなさい"> 所有するポインターを実装するために、<code>nsCOMPtr</code> を使いなさい </h3>
<p>それは、明示的で効果的、かつとても頑丈です。「getter」と「setter」を書くのは簡単です。そしてあなたはデストラクターに何も書く必要がありません。
</p>
<div class="originaldocinfo">
<h2 id="原文書の情報"> 原文書の情報 </h2>
<ul><li> 著者: <a class="external" href="http://www.meer.net/ScottCollins/">Scott Collins</a>
</li><li> 最終更新日: May 8, 2003
</li><li> 著作権: Copyright© 1999 by Netscape; use is subject to the <a class="external" href="http://www.mozilla.org/NPL/">NPL</a>. Portions of this content are © 1998–2007 by individual mozilla.org contributors; content available under a Creative Commons license | <a class="external" href="http://www.mozilla.org/foundation/licensing/website-content.html">詳細</a>
</li></ul>
</div>
<div class="noinclude">
</div>
