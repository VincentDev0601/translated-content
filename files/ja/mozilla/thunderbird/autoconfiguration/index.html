---
title: Thunderbird のアカウント情報自動設定機能
slug: Mozilla/Thunderbird/Autoconfiguration
tags:
  - Administration
  - enterprise
translation_of: Mozilla/Thunderbird/Autoconfiguration
---
<p>著者: Ben Bucksch<br>著者へ相談せずに文書の内容を変更しないで下さい</p> <p>Thunderbird 3.1 以降から追加された自動設定機能の一つに，アカウントの情報を自動で設定する機能があります（一部の機能は 3.0 から利用できます）．この機能は，ユーザがメールサーバの通信設定をとても簡単に設定できるようにする，という目的のもと開発されました．これにより，Thunderbird をダウンロードしてインストールを行ない，アカウントのセットアップウィザードから本名と Email アドレス，そしてパスワードを入力するだけで，できる限り安全にメールを送受信することができるようになります．</p> <p>参考:</p> <ul> <li><a class=" link-https" href="https://wiki.mozilla.org/Thunderbird:Autoconfiguration" title="https://wiki.mozilla.org/Thunderbird:Autoconfiguration">Mozilla wiki におけるプロジェクトのページ</a> には背景，デザイン，実装をはじめとした自動設定機能の詳しい説明が存在します．</li> <li>ユーザ向けの利用方法については Thunderbird Knowledge Base の<a class=" external" href="http://support.mozillamessaging.com/en-US/kb/Automatic+Account+Configuration" title="http://support.mozillamessaging.com/en-US/kb/Automatic+Account+Configuration">Automatic Account Configuration</a> を参照して下さい．</li> <li>設定ファイルの <a href="/en/Thunderbird/Autoconfiguration/FileFormat/HowTo" title="en/Thunderbird/Autoconfiguration/FileFormat/HowTo">説明</a> と <a href="/en/Thunderbird/Autoconfiguration/FileFormat/Definition" title="en/Thunderbird/Autoconfiguration/FileFormat/Definition">定義</a> に関するページも存在します．</li>
</ul> <p>この文書は，いかにして自動設定機能が動作するか，そして何を行えばメールサーバが自動で設定機能されるか，について説明を行ないます．</p> <h1 id="メカニズム">メカニズム</h1> <p>Thunderbird は様々なユースケースにあわせ，色々な方法でサーバの情報を取得します:</p> <ul> <li>ISPDB<br> IPSDB は Mozilla Messaging によって管理されているデータベースで，誰でもその中にある情報を利用することができます．現在は非常に大規模な ISP 向けの設定を中心に保持していますが，早く全ユーザの 50 % 程度をカバーできるぐらいの情報を提供したいと考えています．<br> この ISPDB は，マイクロソフトなどの巨大な ISP が，後述する Mozilla 用の情報をすぐに提供してくれるとは考えられなかったために用意されました．</li> <li>ISP での設定ファイルサーバ<br> ISP は autoconfig.&lt;domain&gt; というドメインで設定情報提供サーバを用意することができます．このサーバは，ユーザからのリクエストを受け付けると，静的な XML 形式（詳細は後述します）で設定ファイルを返却します．ユーザのメールアドレスにサーバへのログイン名が含まれないなど複雑な場合には，（内部でメールアドレスからのログイン名ルックアップなどを行ない）XML ファイルを動的に生成する必要があります．このような場合には，この設定ファイルサーバを用意する方式が，自動設定機能用の情報を提供するための唯一の方法となります．</li> <li>ディスク上の設定ファイル<br> 管理者が Thunderbird のインストールディレクトリに設定ファイルを配置するという方法も存在します． この方法は，企業が社員の PC へ Thunderbird を導入する際，設定ファイル用のサーバを用意せずに自動設定を行えるようにする，というユースケースを想定して用意されました．そのため，それ以外の場面ではこの方法はあまり実用的ではありません．というのも，設定ファイルを一度配置してしまうと，その後で更新を行なうことが難しいためです．よって，公共の ISP は設定ファイルサーバを準備する必要があるでしょう．</li> <li>推測<br> 上で述べた方式が全て失敗した場合，Thunderbird はサーバの設定を推測します．imap.&lt;domain&gt;, smtp.&lt;domain&gt;, mail.&lt;domain&gt; のように，一般的なサーバの名前を試し，サーバから応答があったら，そのサーバが SSL や STARTTLS, そして暗号化パスワード (CRAM-MD5) をサポートするかをチェックします．</li> <li>手動設定<br> 推測にも失敗してしまった場合は，ユーザに手動で設定を行なってもらう必要があります．また，上記の自動取得によってうまく情報が設定された場合にも，ユーザはあとからその情報を修正することができます．</li>
</ul> <p>全てのルックアップ (lookup) メカニズムは「Email アドレスのドメイン部分」をベースとして使います．例えばメールアドレスが <a class="moz-txt-link-abbreviated link-mailto" href="mailto:fred@example.com">fred@example.com</a> であったときルックアップは次のような順番で行われます:</p> <ol> <li>PC 内から <em>Thunderbird のインストール先</em>/isp/example.com.xml を探す</li> <li>autoconfig.example.com をチェック</li> <li>"example.com" を ISPDB 中から探す</li> <li>DNS から"MX example.com" を探し， mx1.mail.hoster.com 向けに ISPDB 中から "hoster.com" を探す</li> <li>それでも駄目なら imap.example.com, smtp.example.com などを試す（推測）</li>
</ol> <p>将来的には DNS SRV もサポートする予定です．</p> <h1 id="自動設定機能をサポートする方法">自動設定機能をサポートする方法</h1> <h2 id="分類">分類</h2> <p> ユーザ数が 100,000 人を超えるような大きな ISP で，"example.com" や "example.de" など数種類のドメインしか提供しない場合は，ISPDB へ設定を登録しても良いですし，設定ファイルサーバを立てても良いでしょう． しかし，サーバが Email アドレスのエイリアスをサポートしていたり，ログイン名がメールアドレスに含まれてないような場合（例えば，メールアドレスは <a class="moz-txt-link-rfc2396E link-mailto" href="mailto:hero@example.com">"hero@example.com"</a> なのに IMAP/POP/SMTP のログイン名が "hero" でも <a class="moz-txt-link-rfc2396E link-mailto" href="mailto:hero@example.com">"hero@example.com"</a> でもなく， "u67578" であるような場合など）は Email アドレスからログイン名をルックアップしてくれるような設定サーバを用意する必要があります．
</p> <p>サーバがカスタマードメインをサポートしている場合（例えば ISP としては"hoster.com" を提供しているのに，ユーザが "<a class=" link-mailto" href="mailto:fred@flintstone.com" rel="freelink">fred@flintstone.com</a>" と"<a class=" link-mailto" href="mailto:louis@kent.com" rel="freelink">louis@kent.com</a>" を利用する場合）は，設定ファイルサーバを用意する必要があります．この場合，DNS MX に頼っても良いでしょう．</p> <p>比較的小さな企業が社員の PC へ Thunderbird をインストールしようとしている場合は，設定ファイルを Thunderbird のインストール先に配置しておくのが良いでしょう．</p> <h2 id="ISPDB">ISPDB</h2> <p>データベースの URL は <a class="moz-txt-link-rfc2396E link-https" href="https://live.mozillamessaging.com/autoconfig/v1.1/" title="https://live.mozillamessaging.com/autoconfig/v1.1/">&lt;https://live.mozillamessaging.com/autoconfig/v1.1/&gt;</a> にドメイン名を付け加えたものとなります（例: <a class="moz-txt-link-rfc2396E link-https" href="https://live.mozillamessaging.com/autoconfig/v1.1/freenet.de" title="https://live.mozillamessaging.com/autoconfig/v1.1/freenet.de">&lt;https://live.mozillamessaging.com/autoconfig/v1.1/freenet.de&gt;</a>）．</p> <p>現段階での登録方法は，次のとおりです: まず Bugzilla にバグを立てて下さい．このとき Product に "Mozilla Messaging", Component に "ispdb" を指定します．そして，以下で説明する要件を満たした設定ファイルを添付します．その後 bwinton, gozer, ben.bucksch の内の誰かへレビューを依頼して下さい．</p> <p>将来的には，単純に設定ファイルを <a class=" link-https" href="https://ispdb.mozillamessaging.com">ISPDB サーバ</a>へアップロードして登録するだけで良いようにしたいと考えています．</p> <h2 id="ISP_サーバにおける設定ファイル">ISP サーバにおける設定ファイル</h2> <p>Email アドレスが <a class="moz-txt-link-rfc2396E link-mailto" href="mailto:fred@example.com">"fred@example.com"</a> のとき，Thunderbird はまず &lt;<span class="external free"><a class="moz-txt-link-freetext external" href="http://autoconfig.example.com/mail/config-v1.xml?emailaddress=fred@example.com">http://autoconfig.example.com/mail/config-v1.1.xml?emailaddress=fred@example.com</a></span>&gt; をチェックし，次に <a class="moz-txt-link-rfc2396E external" href="http://example.com/.well-known/autoconfig/mail/config-v1.1.xml" title="http://example.com/.well-known/autoconfig/mail/config-v1.1.xml">&lt;http://example.com/.well-known/autoconfig/mail/config-v1.1.xml&gt;</a> をチェックします．</p> <h3 id="小さな企業">小さな企業</h3> <p>小さな企業では，<a class="moz-txt-link-rfc2396E external" href="http://example.com/.well-known/autoconfig/mail/config-v1.1.xml">&lt;http://example.com/.well-known/autoconfig/mail/config-v1.1.xml&gt;</a> といったアドレスで XML 形式の設定ファイルを単にサーバへ配置するだけで OK です．</p> <h3 id="ドメイン保有者_(ISP)">ドメイン保有者 (ISP)</h3> <p>ISP 自体は hoster.com というアドレスを提供しているが，ISP のユーザは fancy.com や example.com といったアドレスを登録しており，そういったアドレス向けにメールを扱う必要がある，といった場合には自動設定サーバを用意する必要があります．</p> <h4 id="DNS">DNS</h4> <p>ISP ユーザのドメイン毎に DNS レコードを追加します（MX, A www など，既存のものに加えてください):<br> <code>autoconfig IN A 10.2.3.4</code><br> や<br> <code>autoconfig IN CNAME autoconfig.hoster.com</code>.<br> 10.2.3.4 や autoconfig.hoster.com は自分の IP アドレス / ホスト名へ変更してください．<br> こうすることにより Thunderbird へ自分が hoster であることを伝えることができます．</p> <h4 id="Web_サーバ">Web サーバ</h4> <p>物理的な IP アドレスへ割り当てられた Web サーバを準備する必要があります．他の Web サーバと同じマシンで稼働させることも可能ですが，<br> <br> Web サーバは，独自ドメインを利用している全ての IPS ユーザのドメイン（autoconfig.*）へマッチするバーチャルホストを使用する必要があります．このとき Apache 用語で言うところの "IP ベースなバーチャルホスト" を利用することができます．これは Apache の設定ファイルにおける「Listen 10.2.3.4:80」を意味します（もちろん，自分の持っている IP アドレスを使うようにしてください）</p> <pre>    &lt;VirtualHost 10.2.3.4:80&gt; # バーチャルホスト設定は，一つの IP に対して必ず一つだけ用意してください！
        DocumentRoot /var/www/autoconfig/
        ServerName autoconfig.hoster.com
    &lt;Directory /var/www/autoconfig&gt;
    Order allow,deny
    allow from all
        &lt;/Directory&gt;
    &lt;/VirtualHost&gt;</pre> <p>設定ファイルを，サーバの /mail/config-v1.1.xml といった URL に配置します．</p> <p>設定ファイルは <code>Content-Type: text/xml</code> （もしくは <code>application/xml</code>）で送信するようにして下さい．それ以外の Content Type で提供されたファイルは無視されます．また，設定ファイルが非 ASCII 文字を含む場合は UTF-8 をエンコーディングとして利用してください．</p> <p>ネームベースのバーチャルホストを使用する場合，全ユーザのドメイン向けに autoconfig サブドメインを用意するのは面倒です．このような場合は，autoconfig.* subdomains にマッチする Rewriterule をデフォルトのバーチャルホスト（Debian では /etc/apache2/sites-enabled/000-default）に用意しておけば良いでしょう:</p> <pre>    &lt;VirtualHost *:80&gt; # バーチャルホスト
    ServerAdmin webmaster@hoster.com
    ServerName www
    DocumentRoot /var/www
    RewriteEngine On
    RewriteCond %{HTTP_HOST} ^autoconfig\. [NC]
    RewriteRule ^/(.*)	http://autoconfig.hoster.com/$1 [L,R=301]
    #...
    &lt;/VirtualHost&gt;
    &lt;VirtualHost *:80&gt;
        DocumentRoot /var/www/autoconfig/
        ServerName autoconfig.hoster.com
    &lt;Directory /var/www/autoconfig&gt;
     	Order allow,deny
    allow from all
        &lt;/Directory&gt;
    &lt;/VirtualHost&gt;
</pre> <h2 id="設定ファイル">設定ファイル</h2> <p><a href="/en/Thunderbird/Autoconfiguration/FileFormat/HowTo" title="en/Thunderbird/Autoconfiguration/FileFormat/HowTo">設定ファイルの作成方法</a> と <a href="/en/Thunderbird/Autoconfiguration/FileFormat/Definition" title="en/Thunderbird/Autoconfiguration/FileFormat/Definition">設定ファイルの定義</a> に詳しい情報があります．</p> <p>{{ languages( { "en": "en/Thunderbird/Autoconfiguration" } ) }}</p>
