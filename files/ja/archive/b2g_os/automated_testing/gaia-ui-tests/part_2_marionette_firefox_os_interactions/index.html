---
title: 'パート 2: Marionette を使って Firefox OS と基本的なやりとりをする'
slug: >-
  Archive/B2G_OS/Automated_testing/gaia-ui-tests/Part_2_Marionette_Firefox_OS_interactions
tags:
  - Automation
  - Firefox OS
  - Gaia
  - Python
  - gaia-ui-tests
  - tests
translation_of: >-
  Archive/B2G_OS/Automated_testing/gaia-ui-tests/Part_2_Marionette_Firefox_OS_interactions
---
<p></p><section class="Quick_links" id="Quick_Links">

<ol>
  <li class="toggle">
      <details>
          <summary>Build and install</summary>
          <ol>
            <li><strong><a href="/ja/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install overview</a></strong></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_build_process_summary">B2G OS build process summary</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/B2G_OS_build_prerequisites">Build prerequisites</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Preparing_for_your_first_B2G_build">Preparing for your first build</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building">Building B2G OS</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_installer_add-on">B2G installer add-on</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Building_for_Flame_on_OS_X">Building B2G OS for Flame on Mac OS X</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Choosing_how_to_run_Gaia_or_B2G">Choosing how to run Gaia or B2G OS</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Compatible_Devices">Compatible Devices</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Installing_on_a_mobile_device">Installing B2G OS on a mobile device</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_update_packages">Creating and applying B2G OS update packages</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building/FOTA_community_builds">Building and installing FOTA community builds</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_Build_Variables_Reference_Sheet">B2G build variables reference sheet</a></li>
          </ol>
      </details>
  </li>
  <li class="toggle">
      <details>
          <summary>Porting B2G OS</summary>
          <ol>
            <li><strong><a href="/ja/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting overview</a></strong></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Porting_B2G_OS/basics">Porting basics</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Porting_B2G_OS/Porting_on_CyanogenMod">Porting on CyanogenMod</a></li>
          </ol>
      </details>
  </li>
  <li class="toggle">
      <details>
          <summary>Developing Gaia</summary>
          <ol>
            <li><strong><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia overview</a></strong></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Running_the_Gaia_codebase">Running the Gaia codebase</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Mulet">Run Gaia on desktop using Mulet</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Understanding_the_Gaia_codebase">Understanding the Gaia codebase</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Making_Gaia_code_changes">Making Gaia code changes</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Testing_Gaia_code_changes">Testing Gaia code changes</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Submitting_a_Gaia_patch">Submitting a Gaia patch</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Build_System_Primer">Gaia build system primer</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Different_ways_to_run_Gaia">Different ways to run Gaia</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/make_options_reference">Make options reference</a></li>
            <li><a href="/ja/docs/Mozilla/B2G_OS/Developing_Gaia/Gaia_tools_reference">Gaia tools reference</a></li>
          </ol>
      </details>
  </li>
  <li><a href="/ja/docs/Mozilla/B2G_OS/API">B2G OS APIs</a></li>
</ol>
</section><p></p>

<p></p><div class="prevnext" style="text-align: right;">
    <p><a href="/ja/docs/Mozilla/Firefox_OS/Platform/Automated_testing/gaia-ui-tests/Part_1_Marionette_Firefox_OS_start" style="float: left;">« 前のページ</a><a href="/ja/docs/Mozilla/Firefox_OS/Platform/Automated_testing/gaia-ui-tests/Part_3_Reusable_tests">次のページ  »</a></p>
</div><p></p>

<div class="summary">
<p><span class="seoSummary">チュートリアルのパート2では、Firefox OSのリモート制御を可能にするいくつかの簡単なMarionetteのコマンドを始めましょう。完全なテスト記述はカバーしていませんが、テストを書くときに使用する基本的なコードの特徴を教えてくれます。パート3では、このコードを実際のテストに進化させるように進行します。</span></p>
</div>

<h2 id="Firefox_OSをスタートアップ">Firefox OSをスタートアップ</h2>

<p>これらのテストを書くとき、Firefox OSをすでに実行し、コマンドを受信する準備をしている必要があります:</p>

<ol>
 <li>デスクトップB2Gを起動します</li>
 <li><em>Settings App &gt; Screen lock &gt; uncheck Lock screen</em>を使用して、ロックスクリーンを無効にします。</li>
 <li><em>Settings App &gt; Display &gt; Screen timeout</em> の設定を <em>never </em>に変更することによって、画面のタイムアウト/スリープモードを無効にします</li>
 <li>我々のテストコマンドを待つために、横側にウィンドウを移動させます</li>
</ol>

<h2 id="Marionetteを発射">Marionetteを発射</h2>

<p>今、Pythonコンソールを起動します: 単にターミナルウィンドウに移動して、<code>python</code>コマンドを発行します。</p>

<p>ここからは、Firefox OSの内部のMarionetteのサーバにコマンドを送信することができます。以下のコマンドの多くを発行した後、あなたは、Firefox OSの応答が表示されるはずです。Pythonのコンソールでは、必要なコードを含むMarionetteライブラリをインポートするために、次のコマンドを入力します:</p>

<pre class="brush: bash">from marionette import Marionette</pre>

<p>今、Marionetteがクライアントからのコマンドを受信する準備をするような、Marionetteセッションを開始するよう、次の2行を実行してください。:</p>

<pre class="brush: bash">marionette = Marionette()
marionette.start_session()</pre>

<p>上述したように、ロック画面を無効にしなかった場合は、このコマンドを使用して、プログラムで画面のロックを解除できます:</p>

<pre class="brush: bash">marionette.execute_script('window.wrappedJSObject.lockScreen.unlock();')</pre>

<h2 id="FirefoxのOS内部の別のフレームへのアクセス">FirefoxのOS内部の別のフレームへのアクセス</h2>

<p>FirefoxのOSでのWebアプリは、色々なiFrameで動作します。別々のフレームにてWebアプリを実行すると、それらにセキュリティのための別個のコンテナと、(Windowのような)視覚管理も提供します。これはアプリが実行されるサンドボックスであるように考えることができます。Marionetteは、一度にフレームの1つで動作することができます。Marionetteを、対話をしようとしているフレームに切り替える必要があります。</p>

<p>トップフレームはまた、System アプリです。すべてのアプリケーションとそれらのフレームは、System アプリの子です。新しいMarionette セッションはSystem のフレームで起動しますが、テストを開始するために、ホーム画面を見つけてそこに切り替える必要があります</p>

<p>iFrameを見つけるために、何とかしてそれを識別する必要があります。Marionette がwebdriverのAPIに基づいているため、要素を見つけるために同じ戦略を使用していますので、webdriverがウェブ要素を識別するのに使用する戦略のいずれかを、簡単に使用することができます。<a href="http://www.w3.org/TR/webdriver/#element-location-strategies">element location strategies</a>で詳細をご覧ください。</p>

<p>このケースでは、ホームスクリーンのiFrameを選択するために、CSSセレクタ<code>div.homescreen iframe</code> を使用します。<code>つまりfind_element()</code>関数は、その2番目の引数としてこれを取り、検索を実行するのにどの選択機構を使うかを決める第1引数を取ります。変数にこの結果を格納し、これを引数として<code>switch_to_frame()</code>関数を実行します。ここで、以下の2つのコマンドを試してみてください:</p>

<pre class="brush: bash"># Switch context to the homescreen iframe and tap on the Contacts app icon
home_frame = marionette.find_element('css selector', 'div.homescreen iframe')
marionette.switch_to_frame(home_frame)</pre>

<div class="note">
<p><strong>注意</strong>: さらに読んでおくのや、フレーム切り替えを説明する図は, <a href="https://blog.mozilla.org/webqa/2013/02/13/part-2-ui-testing-on-firefox-os-working-with-iframes/">Working with iFrames</a>をご覧ください。</p>
</div>

<h2 id="アプリケーションの開始">アプリケーションの開始</h2>

<p>OKです。今、アイコンを確認できるホームスクリーンアプリにいて、<code>tap()</code>関数と<code>find_element()</code>関数をの組み合わせて使用し、そのアイコンをタップすることができます。</p>

<pre class="brush: bash"><code>contacts_icon = marionette.find_element('xpath', "</code><code>//div[@class='icon']//span[contains(text(),'Contacts')]")</code>
contacts_icon.tap()</pre>

<p>すべてがうまく行っている場合、ここで連絡先アプリを開いて見えるようにする必要がありますが、前にホームスクリーンで行ったように、対話するためには、まだ連絡先アプリのフレームに切り替える必要があります。:</p>

<pre class="brush: bash"># First, we need to switch context back to the System frame
marionette.switch_to_frame()

# Now, switch context to the contacts app frame
contacts_frame = marionette.find_element('css selector', "iframe[data-url*='contacts']")
marionette.switch_to_frame(contacts_frame)</pre>

<p>フレーム切り替えは<code>True</code>を返すべきです。これができた場合、素晴らしい。これは連絡先アプリのコンテキスト内に入っていて、これを使用し始める準備ができていることを意味します。</p>

<h2 id="アプリを操作する">アプリを操作する</h2>

<p>次のステップでは、典型的なテストのタスクを実行します — 、新しい連絡先を作成し、それに名前を入力し、それを保存します。最初に、追加の連絡先ボタンをタップします:</p>

<pre class="brush: bash"># Tap [+] to add a new Contact
marionette.find_element('id', 'add-contact-button').tap()</pre>

<p>今度は、次の2つのコマンドを使用して連絡先の名前を追加してみましょう(<code>send_keys()</code>は要素に値を挿入するために使用されます):</p>

<pre class="brush: bash">marionette.find_element('id', 'givenName').send_keys('Foo')
# Add the contact's surname
marionette.find_element('id', 'familyName').send_keys('Bar')</pre>

<p>今、連絡先を保存するために<em>Done</em>ボタンをタップしましょう:</p>

<pre class="brush: bash"><code class="language-html">marionette.find_element('id', 'save-button').tap()</code></pre>

<p>今、連絡先アプリの内部に入力した新しい連絡先が表示されます。そうなっていれば、素晴らしいです！</p>

<div class="note">
<p><strong>注意</strong>: そうなっていない場合、連絡先アプリをリセットか停止して、Firefox OSでホームスクリーンの裏にナビゲートし、タスクを再実行してみてください。</p>
</div>

<h2 id="Marionetteセッションを閉じます">Marionetteセッションを閉じます</h2>

<p>最後に、次のコマンドを発行して、Marionetteセッションを終了する必要があります:</p>

<pre class="brush: bash">marionette.delete_session()</pre>

<p>これはかなりうまくいきましたが、テストを実行しようとするたびにPythonのコンソールに入力を始めることはできません。第3部では、テストを実行するたびに再利用できるように、Pythonのファイル内にこのスクリプトをコンパイルします。我々はテストに合格したか失敗したかを区別できるように、アサーションも追加します。</p>

<div class="note">
<p><strong>注意</strong>: Marionetteコマンドを記述する場合、必要となるロケータを把握するには、アプリの基本的なHTML構造にアクセスすることが極めて重要であるということが、確実にわかるでしょう。<a href="https://developer.mozilla.org/Firefox_OS/Platform/Automated_testing/gaia-ui-tests/Part_7_Writing_your_own_tests#Resources">Part 7: Writing your own tests</a>では、これについて役立つ有用なリソースを提供しています。</p>
</div>

<p> </p>
